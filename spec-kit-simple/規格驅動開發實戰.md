# 規格驅動開發實戰：AI 時代的軟體開發新典範

## 學員實作手冊

本手冊旨在引導學員透過 Copilot CLI 與 Spec Kit 的上手實作，掌握規格驅動開發 (Specification-Driven Development, SDD) 的核心概念與實踐方法。SDD 是一種以規格為核心的軟體開發方法，特別適合在 AI 時代下提升開發效率與軟體品質。本課程將以實際案例為基礎，帶領學員從環境準備、規格制定到功能實作，逐步完成一個完整的專案，並學習如何應對開發過程中的常見挑戰。

> **📚 內容出處**
> 本文件轉自：https://sdd.gh.miniasp.com/labs/

---

## 第一次迭代

### 環境準備

#### 1. 建立專案資料夾

```powershell
mkdir duotify-membership-v1
chdir duotify-membership-v1
```

#### 2. 檢查 Specify CLI 工具環境

```powershell
specify check
```

#### 3. 初始化 Spec Kit 專案範本

```powershell
specify init --ai copilot --script ps --here
```

#### 4. 建立一個 `AGENTS.md` 檔案（給 Copilot CLI 看的）

檔案內容如下：

```markdown
We're going to be using slash command from `.github\prompts\`
```

加入版控：

```powershell
git add AGENTS.md && git commit -m "Add AGENTS.md"
```

#### 5. 啟動 GitHub Copilot CLI 互動式環境

更新 Copilot CLI 到最新版：

```powershell
npm i -g @github/copilot
```

透過 `copilot -v` 命令查看 Copilot CLI 版本：

```
0.0.343
Commit: 5847051
```

啟動 GitHub Copilot CLI 互動式環境：

```powershell
copilot --allow-all-tools
```

---

### 制定憲法

透過以下命令制定專案原則：

```powershell
/speckit.constitution
Create principles focused on code quality, testing standards, user experience consistency, and performance requirements
```

```powershell
/speckit.constitution
Add a new rule ti the constitution. Keep this doc in English only.
All specifications, plans, and user-facing documentation MUST be written in Traditional Chinese (zh-TW)
```

---

### 制定規格

執行規格制定命令：

```powershell
/speckit.specify
```

#### 會員註冊流程規格

我們的核心目標是讓新使用者能透過一個簡單、安全的流程，順利註冊帳號並完成 E-Mail 驗證，以便使用平台功能。

**基本流程：**
- 整個註冊是一個單向流程，無法返回上一步
- 使用者首先需要填寫身分證字號、姓名等資料，並設定一組 8 到 20 碼、包含英文大小寫與數字的密碼
- 系統會檢查身分證字號，防止重複註冊

**E-Mail 驗證流程：**
- 送出資料後，系統會寄出一封內含 6 位數驗證碼的 E-Mail，有效時間為 5 分鐘
- 使用者必須手動輸入驗證碼來完成驗證

**未驗證帳號的功能限制：**
- 如果使用者未完成 E-Mail 驗證，依然可以用剛設定的帳號密碼登入，但部分功能將受限
- 直到輸入正確的驗證碼後，帳號所有功能才會被啟用
- 註冊完成後，系統不會自動登入

**規格範圍說明：**
- 為了讓流程單純，我們不做社群帳號註冊
- 不提供密碼強度提示
- 不支援點擊 E-Mail 連結直接驗證

> 💡 注意：你隨時可以再次執行 `/speckit.specify` 命令進行修正，此步驟支援差異更新！

---

### 釐清問題

執行釐清命令以確保需求明確：

```powershell
/speckit.clarify
```

#### 問題 1：未驗證使用者的功能限制範圍

**問題圖示** - 需要確認未驗證使用者的功能限制範圍

**答案：** C

#### 問題 2：錯誤驗證碼輸入次數限制

**問題圖示** - 需要確認錯誤驗證碼輸入次數是否有限制

**答案：** A

#### 問題 3：Email 地址是否可重複註冊

**問題圖示** - 確認同一 Email 地址是否允許多次註冊

**答案：** A（不允許重複註冊）

#### 問題 4：Email 註冊流程中斷後的恢復機制

**答案：** 原則上完成帳號資料填寫即可登入，會員帳號管理就有重啟驗證 Email 的設計

#### 問題 5：Email 遞送失敗的處理策略

**問題圖示** - 確認 Email 無法遞送時的處理方式

**答案：** C

**工程師提問：** 他輸入完就忘記密碼怎麼辦？他也收不到信，但身份證是對的！沒通過驗證，忘記密碼，身份證正確，E-mail 收不到，怎麼辦？

**PM 回覆：** 如果他連 Email 都收不到，又忘記密碼，那只能回歸到人工線下處理。這樣下個階段就有東西可以優化了！XD

#### 澄清流程完成報告

所有問題已釐清，團隊對需求有共識。

> 備註：事實上這些問題在需求訪談階段就該整體盤點，但很多時候遺憾的是，大家都到開發階段才看見問題！

---

### 制定開發計畫

執行計畫制定命令：

```powershell
/speckit.plan
```

輸入計畫指示：

```
We are going to generate this using ASP.NET Core 8.0 Web API, using SQL Server as the database. This project is mainly for backend REST API only. No frontend implementation is required. Use EF Core Code First workflow.
I don't want to use AutoMapper to map DTO. Use POCO instead.
I don't want to use Redis.
I don't want to use Minimal APIs.
```

**實作計畫完成總結** - 已生成詳細的開發計畫

---

### 規劃任務清單

執行任務規劃命令：

```powershell
/speckit.tasks
```

系統將自動生成詳細的任務清單，包括：
- 資料庫設計
- 實體類別建立
- API 端點開發
- 驗證邏輯實作
- 測試計畫

---

### 產生規格分析報告

生成規格分析報告並保存：

```powershell
/speckit.analyze Save your analyze report to `analyze-01.md`
```

此步驟將產生詳細的分析報告，包括所有需求分解與技術考量。

---

### 開始實作

執行實作命令：

```powershell
/speckit.implement
```

#### 選項 1：示範性實作（推薦）

選擇示範性實作，系統將提供完整的實作流程。

#### Phase 2：建立實體類別和資料庫設定

系統自動建立：
- User 實體類別
- EmailVerification 實體類別
- DbContext 設定
- EF Core 遷移配置

#### Phase 3：實作使用者故事 1（註冊與驗證功能）

實作核心功能：
- 使用者註冊 API
- Email 驗證碼生成邏輯
- Email 驗證 API
- 密碼驗證

#### Phase 4：登入功能（未驗證使用者登入）

實作登入相關功能：
- 使用者登入 API
- JWT Token 生成
- 未驗證使用者的權限控制

#### 補充單元測試和整合測試

新增完整的測試涵蓋：
- 單元測試
- 整合測試
- 邊界情況測試

#### 完成剩下的功能實作

實作其他必要功能：
- 密碼重置功能
- 驗證碼重新發送
- 帳號管理 API

---

## 第二次迭代

### 修正已完成的規格

修訂已完成的規格時，可以再次執行 `/speckit.specify` 命令進行編修，此步驟支援差異更新！

#### 小幅修正（建議）

例如，如果需要更新密碼複雜度規格：

```powershell
/speckit.specify
請更新規格，我希望密碼複雜度的規格不接受特殊符號。
然後一併幫我更新 @specs\001-會員註冊流程\plan.md 與 @specs\001-會員註冊流程\tasks.md
```

後續再執行修改程式碼的指令：

```powershell
請根據本次的規格變更，一併修改所有相關的程式碼
```

> 💡 核心觀念：不要一次把程式碼寫完，永遠是先 Review 規格，再動手改程式！

#### 打掉重練

如果規格變動較大，建議重新走一遍流程：

1. 手動刪除 `specs\001-會員註冊流程` 規格目錄內的 `plan.md` 與 `tasks.md` 規格
2. 刪除所有相關程式碼
3. 重新走一次流程

> 💡 建議採用 `git revert` 命令，還原特定版本，所以不斷的版控很重要！

**重新生成流程：**

1. 重新生成開發計畫：
```powershell
/speckit.plan
```

2. 重新生成任務清單：
```powershell
/speckit.tasks
```

3. 產生規格分析報告：
```powershell
/speckit.analyze Save your analyze report to `analyze-02.md`
```

4. 重新實作程式碼：
```powershell
/speckit.implement
```

> 💡 秘技：斷捨離！不要跟你的「程式碼」有任何情感糾葛！😅

---

## 開發下一份規格

開發下一份規格時，只需單純將 Git 切換回 `main` 或 `develop` 分支即可：

```powershell
git switch main
```

然後重複第一次迭代的流程以開發新功能。

---

## 核心概念總結

### 規格驅動開發的優勢

1. **明確需求** - 在編程前充分理解需求
2. **高效協作** - 團隊對需求有共識
3. **智能輔助** - 利用 AI 提升開發效率
4. **質量保證** - 系統化的測試與驗證
5. **易於迭代** - 規格層級的修改，程式碼自動更新

### 關鍵工具

- **Copilot CLI** - 命令行互動介面
- **Spec Kit** - 規格管理與程式碼生成工具
- **ASP.NET Core 8.0** - 後端 Web API 框架
- **SQL Server** - 資料庫
- **EF Core** - Object-Relational Mapping

### 最佳實踐

1. 制定清晰的憲法（開發原則）
2. 完整的規格制定
3. 充分的需求澄清
4. 詳細的計畫與任務分解
5. 迭代式的實作與修正
6. 完整的測試涵蓋
7. 善用版本控制
