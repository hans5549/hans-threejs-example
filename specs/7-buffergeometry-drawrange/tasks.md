# Tasks: BufferGeometry DrawRange 互動式粒子網絡

**Date**: 2025-11-28  
**Branch**: `7-buffergeometry-drawrange`  
**Plan**: [plan.md](plan.md)

---

## 任務總覽

| ID | 任務 | 優先級 | 預估時間 | 狀態 |
|----|------|--------|----------|------|
| T1 | 建立基礎 HTML 結構 | P1 | 15 min | ⬜ |
| T2 | 實作場景初始化 | P1 | 20 min | ⬜ |
| T3 | 實作粒子系統 | P1 | 30 min | ⬜ |
| T4 | 實作連線系統 | P1 | 40 min | ⬜ |
| T5 | 實作 GUI 控制面板 | P2 | 20 min | ⬜ |
| T6 | 實作軌道控制與自動旋轉 | P2 | 15 min | ⬜ |
| T7 | 實作響應式調整 | P3 | 10 min | ⬜ |
| T8 | 效能驗證與優化 | P2 | 20 min | ⬜ |

---

## 任務詳情

### T1: 建立基礎 HTML 結構

**優先級**: P1  
**預估時間**: 15 分鐘  
**相依性**: 無

**描述**:
建立 `examples/buffergeometry-drawrange/index.html`，包含基本 HTML 結構、CSS 樣式和 import map 設定。

**驗收條件**:
- [ ] HTML5 文件結構完整
- [ ] 包含 container 和 info div
- [ ] CSS 設定全螢幕黑色背景
- [ ] import map 設定 Three.js r160 CDN 路徑
- [ ] 檔案可在瀏覽器正常開啟

**參考**: 現有範例 `interactive-raycasting-points/index.html`

---

### T2: 實作場景初始化

**優先級**: P1  
**預估時間**: 20 分鐘  
**相依性**: T1

**描述**:
實作 `init()` 函式，建立 Three.js 核心物件（Scene、Camera、Renderer、Group）以及 BoxHelper 邊界框。

**驗收條件**:
- [ ] PerspectiveCamera 設定正確（FOV 45, z=1750）
- [ ] WebGLRenderer 啟用 antialias
- [ ] 使用 setAnimationLoop 設定動畫迴圈
- [ ] BoxHelper 顯示 800x800x800 邊界
- [ ] Stats 效能監測顯示
- [ ] 場景在瀏覽器正常渲染

---

### T3: 實作粒子系統

**優先級**: P1  
**預估時間**: 30 分鐘  
**相依性**: T2

**描述**:
實作粒子位置初始化、BufferGeometry 設定、Points 物件建立，以及每幀位置更新和邊界反彈邏輯。

**驗收條件**:
- [ ] 500 個粒子在場景中顯示（預設）
- [ ] 粒子隨機分佈在立方體邊界內
- [ ] 粒子持續移動
- [ ] 碰到邊界時反彈
- [ ] 使用 DynamicDrawUsage 設定
- [ ] 使用 setDrawRange 控制渲染數量

---

### T4: 實作連線系統

**優先級**: P1  
**預估時間**: 40 分鐘  
**相依性**: T3

**描述**:
實作粒子間距離計算、連線頂點和顏色生成、LineSegments 物件建立，以及透明度隨距離變化的效果。

**驗收條件**:
- [ ] 距離小於 150（預設）的粒子產生連線
- [ ] 連線透明度隨距離變化（越近越不透明）
- [ ] 使用 vertexColors 實現每線段獨立顏色
- [ ] 使用 AdditiveBlending 產生發光效果
- [ ] setDrawRange 正確控制連線數量
- [ ] 連接數量限制功能正常

---

### T5: 實作 GUI 控制面板

**優先級**: P2  
**預估時間**: 20 分鐘  
**相依性**: T4

**描述**:
使用 lil-gui 建立控制面板，包含所有 effectController 參數的控制項和 onChange 回呼。

**驗收條件**:
- [ ] showDots 控制粒子顯示/隱藏
- [ ] showLines 控制連線顯示/隱藏
- [ ] minDistance 滑桿 (10-300) 即時生效
- [ ] limitConnections 開關正常運作
- [ ] maxConnections 滑桿 (0-30) 正常運作
- [ ] particleCount 滑桿 (0-1000) 即時調整粒子數

---

### T6: 實作軌道控制與自動旋轉

**優先級**: P2  
**預估時間**: 15 分鐘  
**相依性**: T2

**描述**:
加入 OrbitControls 讓使用者能旋轉、縮放和平移視角，同時實作場景自動緩慢旋轉。

**驗收條件**:
- [ ] 滑鼠左鍵拖曳可旋轉視角
- [ ] 滾輪可縮放（1000-3000 距離限制）
- [ ] 滑鼠右鍵拖曳可平移
- [ ] 場景持續緩慢自動旋轉
- [ ] 互動控制流暢無卡頓

---

### T7: 實作響應式調整

**優先級**: P3  
**預估時間**: 10 分鐘  
**相依性**: T2

**描述**:
實作 `onWindowResize()` 函式，處理視窗大小變化時的攝影機和渲染器調整。

**驗收條件**:
- [ ] 視窗大小改變時場景自動調整
- [ ] 長寬比保持正確
- [ ] 無視覺變形或裁切

---

### T8: 效能驗證與優化

**優先級**: P2  
**預估時間**: 20 分鐘  
**相依性**: T1-T7

**描述**:
驗證在不同粒子數量下的效能表現，確保達到規格中定義的 FPS 目標。

**驗收條件**:
- [ ] 200 粒子時達到 60 FPS
- [ ] 500 粒子時達到 30+ FPS
- [ ] 1000 粒子時仍可運作（可能 <30 FPS）
- [ ] GUI 操作延遲 <16ms
- [ ] 無記憶體洩漏

---

## 完成檢查清單

實作完成後，驗證以下規格要求：

- [ ] FR-001: 最多 1000 個粒子渲染
- [ ] FR-002: 每幀更新位置並邊界反彈
- [ ] FR-003: 使用 BufferGeometry + DynamicDrawUsage
- [ ] FR-004: 使用 setDrawRange 控制渲染
- [ ] FR-005: 計算距離並繪製連線
- [ ] FR-006: 透明度隨距離變化
- [ ] FR-007: 顯示立方體邊界框
- [ ] FR-008: GUI 控制面板完整
- [ ] FR-009: OrbitControls 正常運作
- [ ] FR-010: 視窗大小自適應
- [ ] FR-011: AdditiveBlending 發光效果
- [ ] FR-012: 顯示 FPS 統計

---

## 風險與緩解

| 風險 | 可能性 | 影響 | 緩解措施 |
|------|--------|------|----------|
| 1000 粒子效能不足 | 中 | 中 | 可降低預設值或限制最大值 |
| CDN 載入失敗 | 低 | 高 | 提供備用 CDN 或錯誤訊息 |
| 舊版瀏覽器不支援 | 低 | 中 | 顯示 WebGL 錯誤訊息 |
